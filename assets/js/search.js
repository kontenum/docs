class KontenumSearch{constructor(){this.index=null,this.documents=[],this.currentLang=this.detectLanguage(),this.init()}detectLanguage(){const e=window.location.pathname;return e.startsWith("/docs/id/")||e.includes("/id/")?"id":"en"}async init(){try{await this.loadFlexSearch(),this.index=new FlexSearch.Index({preset:"match",tokenize:"forward",cache:!0,context:{resolution:9,depth:3,bidirectional:!0}}),await this.loadSearchIndex(),this.setupSearchListeners()}catch(e){console.error("Failed to initialize search:",e)}}async loadFlexSearch(){return window.FlexSearch?Promise.resolve():new Promise((e,t)=>{const s=document.createElement("script");s.src="/assets/js/flexsearch.bundle.js",s.onload=()=>{e()},s.onerror=e=>{console.error("FlexSearch loading error:",e),t(new Error("Failed to load FlexSearch"))},document.head.appendChild(s)})}async loadSearchIndex(){try{const e=await fetch(`/search-index-${this.currentLang}.json`);this.documents=await e.json(),this.documents.forEach(e=>{const t=`${e.title} ${e.content}`;this.index.add(e.id,t)})}catch(e){console.error("Failed to load search index:",e)}}setupSearchListeners(){document.querySelectorAll(".search-input").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.showSearchModal()}),e.addEventListener("focus",e=>{e.preventDefault(),e.stopPropagation(),this.showSearchModal()})})}performSearch(e){if(!e||e.length<2)return void this.closeSearchResults();const t=this.index.search(e,{limit:10}).map(e=>this.documents[e]).filter(Boolean);this.displayResults(t,e)}displayResults(e,t){const s=document.getElementById("search-results-list"),n=document.getElementById("search-results-count");if(s){if(0===e.length)return n.textContent="No results found",void(s.innerHTML='\n        <div class="text-center text-muted py-5">\n          <i class="ti ti-search-off mb-2" style="font-size: 3rem;"></i>\n          <div>No results found</div>\n        </div>\n      ');n.textContent=`${e.length} result${1!==e.length?"s":""} found`,s.innerHTML=e.map(e=>this.createResultItem(e,t)).join("")}}createResultItem(e,t){const s=this.getExcerpt(e.content,t);return`\n      <a href="${e.url}" class="search-result-item">\n        <div class="search-result-title">${this.highlightText(e.title,t)}</div>\n        <div class="search-result-excerpt">${this.highlightText(s,t)}</div>\n      </a>\n    `}getExcerpt(e,t){const s=e.toLowerCase(),n=t.toLowerCase(),a=s.indexOf(n);if(-1===a)return e.substring(0,150)+"...";const r=Math.max(0,a-60),c=Math.min(e.length,a+t.length+90);let o=e.substring(r,c);return r>0&&(o="..."+o),c<e.length&&(o+="..."),o}highlightText(e,t){if(!t)return e;const s=new RegExp(`(${t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return e.replace(s,"<mark>$1</mark>")}showSearchModal(){let e=document.getElementById("search-modal");e||(e=this.createSearchModal(),document.body.appendChild(e)),e.style.display="flex",document.body.style.overflow="hidden",setTimeout(()=>{const t=e.querySelector("#search-modal-input");t&&t.focus()},100)}createSearchModal(){const e=document.createElement("div");e.id="search-modal",e.className="search-modal",e.innerHTML='\n      <div class="search-modal-backdrop"></div>\n      <div class="search-modal-content">\n        <div class="search-modal-header">\n          <div class="search-modal-input-wrapper">\n            <i class="ti ti-search search-modal-icon"></i>\n            <input type="text" id="search-modal-input" class="search-modal-input" placeholder="Search documentation..." autocomplete="off">\n            <button class="search-modal-close" id="search-modal-close">\n              <i class="ti ti-x"></i>\n            </button>\n          </div>\n        </div>\n        <div class="search-modal-body">\n          <div class="search-results-count" id="search-results-count">Type to search...</div>\n          <div class="search-results-list" id="search-results-list"></div>\n        </div>\n      </div>\n    ';const t=e.querySelector("#search-modal-input"),s=e.querySelector("#search-modal-close"),n=e.querySelector(".search-modal-backdrop");let a;t.addEventListener("input",e=>{clearTimeout(a),a=setTimeout(()=>{this.performSearch(e.target.value)},300)});const r=()=>{e.style.display="none",document.body.style.overflow="",t.value="",document.getElementById("search-results-list").innerHTML="",document.getElementById("search-results-count").textContent="Type to search..."};return s.addEventListener("click",r),n.addEventListener("click",r),e.addEventListener("keydown",e=>{"Escape"===e.key&&r()}),e}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{new KontenumSearch}):new KontenumSearch;